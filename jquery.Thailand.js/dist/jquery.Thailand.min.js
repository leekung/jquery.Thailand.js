/**
* @name jquery.Thailand.js
* @version 1.5.3.5
* @update May 31, 2018
* @website https://github.com/earthchie/jquery.Thailand.js
* @license WTFPL v.2 - http://www.wtfpl.net/
*
* @dependencies: jQuery <https://jquery.com/>
*              zip.js <https://github.com/gildas-lormeau/zip.js> (optional: for zip database_type only)
*              typeahead.js <https://twitter.github.io/typeahead.js/>
*              JQL.js <https://github.com/earthchie/JQL.js>
**/
$.Thailand=function(o){"use strict";o=$.extend({},$.Thailand.defaults,o);var i=function(e){var t=[];for(var a in e){var i=a.split("|")[0],n=a.split("|")[1]||!1;for(var r in e[a]){var o=r.split("|")[0],c=r.split("|")[1]||!1;for(var s in e[a][r]){var d=s.split("|")[0],p=s.split("|")[1]||!1;for(var l in e[a][r][s])t.push({district:d,district_code:p,amphoe:o,amphoe_code:c,province:i,province_code:n,zipcode:e[a][r][s][l]})}}}return t},h=function(e,t,a){var i,n,r,o,c=0,s=0,d=0,p=(e+="").length,l=(t+="").length;for(i=0;i<p;i+=1)for(n=0;n<l;n+=1){for(r=0;i+r<p&&n+r<l&&e.charAt(i+r)===t.charAt(n+r);)r+=1;d<r&&(d=r,c=i,s=n)}return(o=d)&&(c&&s&&(o+=h(e.substr(0,s),t.substr(0,s),!1)),c+d<p&&s+d<l&&(o+=h(e.substr(c+d,p-c-d),t.substr(s+d,l-s-d),!1))),!1===a?o:e===t?100:l<p?Math.floor(o/p*100):Math.floor(o/l*100)};!function(a){var e,t=o.database_type.toLowerCase();switch("json"!==t&&"zip"!==t&&(t=o.database.split(".").pop()),t){case"json":$.getJSON(o.database,function(e){a(new JQL(i(e)))}).fail(function(e){throw new Error('File "'+o.database+'" is not exists.')});break;case"zip":o.zip_worker_path||$("script").each(function(){var e=this.src.split("/");"zip.js"===e.pop()&&(zip.workerScriptsPath=e.join("/")+"/")}),(e=new XMLHttpRequest).responseType="blob",e.onreadystatechange=function(){if(4===e.readyState){if(200!==e.status)throw new Error('File "'+o.database+'" is not exists.');zip.createReader(new zip.BlobReader(e.response),function(e){e.getEntries(function(e){e[0].getData(new zip.BlobWriter,function(e){var t=new FileReader;t.onload=function(){a(new JQL(i(JSON.parse(t.result))))},t.readAsText(e)})})})}},e.open("GET",o.database),e.send();break;default:throw new Error('Unknown database type: "'+o.database_type+'". Please define database_type explicitly (json or zip)')}}(function(n){var e=o.id||0;$.Thailand.DB=$.Thailand.DB?$.Thailand.DB:{},$.Thailand.DB[e]=n;var a,i,t={empty:" ",suggestion:function(e){return e.zipcode&&(e.zipcode=" » "+e.zipcode),"<div>"+e.district+" » "+e.amphoe+" » "+e.province+e.zipcode+"</div>"}},r=function(e,t){for(a in o)i=a.replace("$",""),-1<a.indexOf("$")&&o.hasOwnProperty(a)&&o[a]&&t[i]&&o[a].typeahead("val",t[i]).trigger("change");"function"==typeof o.onDataFill&&(delete t.likely,o.onDataFill(t))};for(a in o)-1<a.indexOf("$")&&"$search"!==a&&o.hasOwnProperty(a)&&o[a]&&o[a].typeahead({hint:!0,highlight:!0,minLength:1},{limit:o.autocomplete_size,templates:t,source:function(e,t){var a=[],i=this.$el.data("field");try{a=n.select("*").where(i).match("^"+e).orderBy(i).fetch()}catch(e){}t(a)},display:function(e){return e[this.$el.data("field")]}}).parent().find(".tt-dataset").data("field",a.replace("$",""));for(a in o.$search&&o.$search.typeahead({hint:!0,highlight:!0,minLength:2},{limit:o.autocomplete_size,templates:t,source:function(t,e){var a=[];try{a=new JQL(a.concat(n.select("*").where("zipcode").match(t).fetch()).concat(n.select("*").where("province").match(t).fetch()).concat(n.select("*").where("amphoe").match(t).fetch()).concat(n.select("*").where("district").match(t).fetch()).map(function(e){return JSON.stringify(e)}).filter(function(e,t,a){return a.indexOf(e)==t}).map(function(e){return(e=JSON.parse(e)).likely=[5*h(t,e.district),3*h(t,e.amphoe.replace(/^เมือง/,"")),h(t,e.province),h(t,e.zipcode)].reduce(function(e,t){return Math.max(e,t)}),e})).select("*").orderBy("likely desc").fetch()}catch(e){}e(a)},display:function(e){return""}}),o)-1<a.indexOf("$")&&o.hasOwnProperty(a)&&o[a]&&o[a].bind("typeahead:select typeahead:autocomplete",r).blur(function(){this.value||$(this).parent().find(".tt-dataset").html("")});"function"==typeof o.onLoad&&o.onLoad(),"function"==typeof o.onComplete&&o.onComplete()})},$.Thailand.defaults={database:"../database/raw_database/db.json",database_type:"auto",zip_worker_path:!1,autocomplete_size:20,id:"0",onLoad:function(){},onDataFill:function(){},$district:!1,$district_code:!1,$amphoe:!1,$amphoe_code:!1,$province:!1,$province_code:!1,$zipcode:!1,$search:!1},$.Thailand.setup=function(e){$.extend($.Thailand.defaults,e)};